require "./version"

module TDS::Charset
  def self.encoding(lcid : UInt16, flags : UInt16, chartset_id : UInt8, version : Version)
    if (flags & 0x4) != 0 && version.value > Version::V7_1.value
      "UTF-8"
    else
      case chartset_id
      when 30, 31, 32, 33, 34
        "CP437"
      when 40, 41, 42, 43, 44, 49, 55, 56, 57, 58, 59, 60, 61
        return "CP850"
      when 80, 81, 82
        return "CP1250"
      when 105, 106
        return "CP1251"
      when 113, 114, 120, 121, 122, 124
        return "CP1253"
      when 137, 138
        return "CP1255"
      when 145, 146
        return "CP1256"
      when 153, 154
        return "CP1257"
      else
        case lcid
        when 0x405, 0x40e, 0x415, 0x418, 0x41a, 0x41b, 0x41c, 0x424, 0x442, 0x81a, 0x104e, 0x141a
          "CP1250"
        when 0x402, 0x419, 0x422, 0x423, 0x42f, 0x43f, 0x440, 0x444, 0x450, 0x82c, 0x843, 0xc1a, 0x46d, 0x201a, 0x485
          cp = "CP1251"
        when 0x1007, 0x1009, 0x100a, 0x100c, 0x1407, 0x1409, 0x140a, 0x140c, 0x1809, 0x180a, 0x180c, 0x1c09, 0x1c0a, 0x2009, 0x200a, 0x2409, 0x240a, 0x2809, 0x280a, 0x2c09, 0x2c0a, 0x3009, 0x300a, 0x3409, 0x340a, 0x380a, 0x3c0a, 0x400a, 0x403, 0x406, 0x417, 0x42e, 0x43b, 0x452, 0x462, 0x47a, 0x47c, 0x47e, 0x483, 0x407, 0x409, 0x40a, 0x40b, 0x40c, 0x40f, 0x410, 0x413, 0x414, 0x416, 0x41d, 0x421, 0x42d, 0x436, 0x437, 0x438, 0x439, 0x43e, 0x440a, 0x441, 0x456, 0x480a, 0x4c0a, 0x500a, 0x807, 0x809, 0x80a, 0x80c, 0x810, 0x813, 0x814, 0x816, 0x81d, 0x83b, 0x83e, 0x85f, 0xc07, 0xc09, 0xc0a, 0xc0c
          cp = "CP1252"
        when 0x408
          cp = "CP1253"
        when 0x41f, 0x42c, 0x443
          cp = "CP1254"
        when 0x40d
          cp = "CP1255"
        when 0x1001, 0x1401, 0x1801, 0x1c01, 0x2001, 0x2401, 0x2801, 0x2c01, 0x3001, 0x3401, 0x3801, 0x3c01, 0x4001, 0x401, 0x480, 0x420, 0x429, 0x48c, 0x801, 0xc01
          cp = "CP1256"
        when 0x425, 0x426, 0x427, 0x827
          cp = "CP1257"
        when 0x42a
          cp = "CP1258"
        when 0x41e
          cp = "CP874"
        when 0x411
          cp = "CP932"
        when 0x1004, 0x804
          cp = "GB18030"
        when 0x412
          cp = "CP949"
        when 0x1404, 0x404, 0xc04
          cp = "CP950"
        else
          cp = "CP1252"
        end
      end
    end
  end
end
