require "./spec_helper"

include TDS

LOGIN_DATA = Bytes[
  0xc4, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x71,
  0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
  0x7b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xe0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x56, 0x00, 0x0f, 0x00,
  0x74, 0x00, 0x02, 0x00, 0x78, 0x00, 0x14, 0x00,
  0xa0, 0x00, 0x05, 0x00, 0xaa, 0x00, 0x09, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xbc, 0x00, 0x04, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x55, 0x00,
  0x4c, 0x00, 0x52, 0x00, 0x49, 0x00, 0x43, 0x00,
  0x48, 0x00, 0x53, 0x00, 0x2d, 0x00, 0x4d, 0x00,
  0x41, 0x00, 0x43, 0x00, 0x42, 0x00, 0x4f, 0x00,
  0x4f, 0x00, 0x4b, 0x00, 0x73, 0x00, 0x61, 0x00,
  0xb3, 0xa5, 0x92, 0xa5, 0xe3, 0xa5, 0x13, 0xa5,
  0xd2, 0xa5, 0x43, 0xa5, 0xb2, 0xa5, 0xd2, 0xa5,
  0xc3, 0xa5, 0x03, 0xa5, 0xb3, 0xa5, 0x92, 0xa5,
  0x33, 0xa5, 0x77, 0xa5, 0xb3, 0xa5, 0x92, 0xa5,
  0x43, 0xa5, 0xb6, 0xa5, 0x86, 0xa5, 0x96, 0xa5,
  0x64, 0x00, 0x62, 0x00, 0x76, 0x00, 0x69, 0x00,
  0x73, 0x00, 0x6c, 0x00, 0x6f, 0x00, 0x63, 0x00,
  0x61, 0x00, 0x6c, 0x00, 0x68, 0x00, 0x6f, 0x00,
  0x73, 0x00, 0x74, 0x00, 0x6a, 0x00, 0x54, 0x00,
  0x44, 0x00, 0x53, 0x00]

describe LoginRequest do
  it "writes correct" do
    io = IO::Memory.new
    LoginRequest.new("sa", "asdkwnqwfjasi-asn123", hostname: "ULRICHS-MACBOOK", appname: "dbvis", servername: "localhost", library_name: "jTDS", process_id: 0x7b_u32).write(io)
    io.to_slice.should eq LOGIN_DATA
  end
end
